CREATE TABLE USERS
(
USER_ID NUMBER(38) CONSTRAINT USER_ID_NN NOT NULL,
USER_NAME VARCHAR2(255) CONSTRAINT USER_NAME_NN NOT NULL,
USER_PHOTO VARCHAR2(255) CONSTRAINT USER_PHOTO_NN NOT NULL,
USER_FATHER_NAME VARCHAR2(255) CONSTRAINT FATHER_NN NOT NULL,
USER_MOTHER_NAME VARCHAR2(255) CONSTRAINT MOTHER_NN NOT NULL,
USER_GENDER VARCHAR2(255) CONSTRAINT GENDER_NN NOT NULL,
USER_DOB DATE CONSTRAINT USER_DOB_NN NOT NULL,
USER_NID VARCHAR2(255) CONSTRAINT USER_NID_NN NOT NULL,
USER_MOBILE_NO VARCHAR2(255) CONSTRAINT USER_MOBILE_NN NOT NULL,
USER_PASSWORD VARCHAR2(255)CONSTRAINT USER_PASSWORD_NN NOT NULL,

CONSTRAINT CHECK_USER_GENDER CHECK (USER_GENDER IN('male','female')),
CONSTRAINT PK_USER_ID PRIMARY KEY(USER_ID),
/*CONSTRAINT UNQ_USER_NID UNIQUE(USER_NID),*/
CONSTRAINT UNQ_USER_MOBILE_NN UNIQUE(USER_MOBILE_NO)
);


CREATE TABLE CUSTOMER
(
CUSTOMER_ID NUMBER(38),
CUSTOMER_BALANCE NUMBER,

CONSTRAINT PK_CUSTOMER_ID PRIMARY KEY (CUSTOMER_ID),
CONSTRAINT FK_CUSTOMER_ID FOREIGN KEY (CUSTOMER_ID) REFERENCES USERS(USER_ID)
);


CREATE TABLE AGENT
(
AGENT_ID NUMBER(38),
AGENT_BANK_AC NUMBER(38) CONSTARINT AGENT_BANK_AC_NN NOT NULL,
AGENT_BALANCE NUMBER,

CONSTRAINT PK_AGENT_ID PRIMARY KEY (AGENT_ID),
CONSTRAINT FK_AGENT_ID FOREIGN KEY (AGENT_ID) REFERENCES USERS(USER_ID)
);


CREATE TABLE OFFERS
(
OFFER_ID NUMBER(38),
DISCOUNT_PERCENT NUMBER CONTRAINT OFFER_NN NOT NULL,

CONSTRAINT PK_OFFER_ID PRIMARY KEY (OFFER_ID),
CONSTRAINT CHECK_DISCOUNT_PERCENT CHECK (DISCOUNT_PERCENT BETWEEN 0 AND 100)
);


CREATE TABLE MERCHANTS
(
MERCHANT_ID NUMBER(38),
MERCHANT_BRANCH_ID NUMBER(38),
MERCHANT_NAME VARCHAR2(255),
MERCHANT_LOGO_IMAGE VARCHAR2(255),
MERCHANT_BANK_AC_NO NUMBER(38) CONSTRAINT MERCHANT_BANK_AC_NN NOT NULL,
OFFER_ID NUMBER(38),

CONSTRAINT PK_MERCHANTS PRIMARY KEY (MERCHANT_ID,MERCHANT_BRANCH_ID),
CONSTRAINT FK_OFFER_ID_MERCHANTS FOREIGN KEY (OFFER_ID) REFERENCES OFFERS(OFFER_ID)
);

CREATE TABLE MOBILE_OPERATOR
(
OPERATOR_ID NUMBER(38),
OPERATOR_NAME VARCHAR2(255),
OPERATOR_BANK_AC_NO NUMBER(38) CONSTRAINT MOBILE_OPERATOR_BANK_AC_NN NOT NULL,

CONSTRAINT PK_MOBILE_OPERATOR PRIMARY KEY(OPERATOR_ID)
);

CREATE TABLE UTILITY_SERVICE
(
SERVICE_ID NUMBER(38),
SERVICE_NAME VARCHAR2(255),
SERVICE_BANK_AC_NO NUMBER(38) CONSTRAINT SERVICE_BANK_AC_NN NOT NULL,

CONSTRAINT PK_UTILITY_SERVICE PRIMARY KEY(SERVICE_ID)
);


CREATE TABLE HISTORY_TYPE
(
TYPE_ID NUMBER(38),
TYPE_NAME VARCHAR2(255),

CONSTRAINT PK_HISTORY_TYPE PRIMARY KEY(TYPE_ID)
);


CREATE TABLE HISTORY
(
HISTORY_ID NUMBER(38),
TYPE_ID NUMBER(38),
TRANSICTION_ID NUMBER(38),
TRANSICTION_TIME DATE,
TRANSICTION_AMOUNT NUMBER,

CONSTRAINT PK_HISTORY_ID PRIMARY KEY(HISTORY_ID),
CONSTRAINT FK_TYPE_ID_HIS FOREIGN KEY(TYPE_ID) REFERENCES HISTORY_TYPE(TYPE_ID)
);


CREATE TABLE PAYMENT
(
MERCHANT_ID NUMBER(38),
MERCHANT_BRANCH_ID NUMBER(38),
USER_ID NUMBER(38),
HISTORY_ID NUMBER(38),

CONSTRAINT PK_PAYMENT PRIMARY KEY(USER_ID,HISTORY_ID,MERCHANT_ID),
CONSTRAINT FK_USER_ID_PAYMENT FOREIGN KEY(USER_ID) REFERENCES USERS(USER_ID),
CONSTRAINT FK_HISTORY_ID_PAYMENT FOREIGN KEY(HISTORY_ID) REFERENCES HISTORY(HISTORY_ID),
CONSTRAINT FK_MERCHANT_ID_PAYMENT FOREIGN KEY(MERCHANT_ID,MERCHANT_BRANCH_ID) REFERENCES MERCHANTS(MERCHANT_ID,MERCHANT_BRANCH_ID)
);


CREATE TABLE CASH_OUT
(
CUSTOMER_ID NUMBER(38),
AGENT_ID NUMBER(38),
HISTORY_ID NUMBER(38),

CONSTRAINT PK_CASH_OUT PRIMARY KEY (CUSTOMER_ID,AGENT_ID,HISTORY_ID),
CONSTRAINT FK_CUSTOMER_ID_C_O FOREIGN KEY (CUSTOMER_ID) REFERENCES CUSTOMER(CUSTOMER_ID),
CONSTRAINT FK_AGENT_ID_C_O FOREIGN KEY (AGENT_ID) REFERENCES AGENT(AGENT_ID),
CONSTRAINT FK_HISTORY_ID_C_O FOREIGN KEY (HISTORY_ID) REFERENCES HISTORY(HISTORY_ID)
);



CREATE TABLE SEND_MONEY
(
FROM_CUSTOMER_ID NUMBER(38),
TO_CUSTOMER_ID NUMBER(38),
HISTORY_ID NUMBER(38),

CONSTRAINT PK_SEND_MONEY PRIMARY KEY (FROM_CUSTOMER_ID,TO_CUSTOMER_ID,HISTORY_ID),
CONSTRAINT FK_FROM_CUSTOMER_ID_S_M FOREIGN KEY (FROM_CUSTOMER_ID) REFERENCES CUSTOMER(CUSTOMER_ID),
CONSTRAINT FK_TO_CUSTOMER_ID_S_M FOREIGN KEY (TO_CUSTOMER_ID) REFERENCES CUSTOMER(CUSTOMER_ID),
CONSTRAINT FK_HISTORY_ID_S_M FOREIGN KEY (HISTORY_ID) REFERENCES HISTORY(HISTORY_ID)
);


CREATE TABLE CASH_IN
(
CUSTOMER_ID NUMBER(38),
AGENT_ID NUMBER(38),
HISTORY_ID NUMBER(38),

CONSTRAINT PK_CASH_IN PRIMARY KEY (CUSTOMER_ID,AGENT_ID,HISTORY_ID),
CONSTRAINT FK_CUSTOMER_ID_C_I FOREIGN KEY (CUSTOMER_ID) REFERENCES CUSTOMER(CUSTOMER_ID),
CONSTRAINT FK_AGENT_ID_C_I FOREIGN KEY (AGENT_ID) REFERENCES AGENT(AGENT_ID),
CONSTRAINT FK_HISTORY_ID_C_I FOREIGN KEY (HISTORY_ID) REFERENCES HISTORY(HISTORY_ID)
);


CREATE TABLE MOBILE_RECHARGE
(
OPERATOR_ID NUMBER(38),
USER_ID NUMBER(38),
HISTORY_ID NUMBER(38),

CONSTRAINT PK_MOBILE_RECHARGE PRIMARY KEY(OPERATOR_ID,USER_ID,HISTORY_ID),
CONSTRAINT FK_OPERATOR_ID_RECHARGE FOREIGN KEY(OPERATOR_ID) REFERENCES MOBILE_OPERATOR(OPERATOR_ID),
CONSTRAINT FK_USER_ID_RECHARGE FOREIGN KEY(USER_ID) REFERENCES USERS(USER_ID),
CONSTRAINT FK_HISTORY_ID_RECHARGE FOREIGN KEY(HISTORY_ID) REFERENCES HISTORY(HISTORY_ID)
);


CREATE TABLE PAY_UTILITY_BILL
(
SERVICE_ID NUMBER(38),
USER_ID NUMBER(38),
HISTORY_ID NUMBER(38),

CONSTRAINT PK_PAY_UTILITY_BILL PRIMARY KEY(SERVICE_ID,USER_ID,HISTORY_ID),
CONSTRAINT FK_USER_ID_PAY_U_B FOREIGN KEY(USER_ID) REFERENCES USERS(USER_ID),
CONSTRAINT FK_HISTORY_ID_PAY_U_B FOREIGN KEY(HISTORY_ID) REFERENCES HISTORY(HISTORY_ID),
CONSTRAINT FK_SERVICE_ID_PAY_U_B FOREIGN KEY(SERVICE_ID) REFERENCES
UTILITY_SERVICE(SERVICE_ID)
);








